<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´´ë¬¼ì„ ë¬¼ë¦¬ì¹˜ê³ , ë„ˆì˜ ì• ì™„ë™ë¬¼ì„ êµ¬í•˜ë¼!</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .game-container {
            text-align: center;
        }
        
        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        
        canvas {
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
        }
        
        .controls {
            margin-top: 15px;
            color: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ± ê´´ë¬¼ì„ ë¬¼ë¦¬ì¹˜ê³ , ë„ˆì˜ ì• ì™„ë™ë¬¼ì„ êµ¬í•˜ë¼! ğŸ±</h1>
        <canvas id="gameCanvas" width="800" height="400"></canvas>
                 <div class="controls">
                          <p>ğŸ® ì¡°ì‘ë²•: ë°©í–¥í‚¤(ì´ë™) | ìŠ¤í˜ì´ìŠ¤ë°”(ì í”„) | 1ë²ˆí‚¤/2ë²ˆí‚¤(ê°€ê´€ì´3ë°œ) | Rí‚¤(ì¥ì „) | Aí‚¤(í­ê²©ê¸°) | ìë™ì² ì¥ì—´ê¸°</p>
         </div>
    </div>

    <script>
        // ê²Œì„ ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            score: 0,
            playerHP: 1500,  // HPë¥¼ 1500ìœ¼ë¡œ ì¦ê°€
            maxHP: 1500,     // ìµœëŒ€ HP ì„¤ì •
            gameOver: false,
            level: 1,
            stage: 1,        // í˜„ì¬ ìŠ¤í…Œì´ì§€
            ammo: 150,  // ì´ì•Œ ê°œìˆ˜ (150ìœ¼ë¡œ ì¦ê°€)
            maxAmmo: 150,  // ìµœëŒ€ ì´ì•Œ ê°œìˆ˜ (150ìœ¼ë¡œ ì¦ê°€)
            isReloading: false,  // ì¥ì „ ì¤‘ì¸ì§€ í™•ì¸
            bomberAvailable: true,  // í­ê²©ê¸° ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€
            hasKey: false,   // ì—´ì‡  ë³´ìœ  ì—¬ë¶€
            petRescued: false,  // ì• ì™„ë™ë¬¼ êµ¬ì¶œ ì—¬ë¶€
            rescueAnimation: false,  // êµ¬ì¶œ ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ
            rescueStartTime: 0  // êµ¬ì¶œ ì‹œì‘ ì‹œê°„
        };
        
        // í”Œë ˆì´ì–´ (ê³ ì–‘ì´)
        const player = {
            x: 100,
            y: 300,
            width: 40,
            height: 40,
            velocityX: 0,
            velocityY: 0,
            isJumping: false,
            groundY: 300,
            color: '#FFA500'
        };
        
        // ì´ì•Œ ë°°ì—´
        const bullets = [];
        
        // ì  ë°°ì—´
        const enemies = [];
        
        // ì  ì´ì•Œ ë°°ì—´
        const enemyBullets = [];
        
        // ë³´ìŠ¤ ë°°ì—´
        const bosses = [];
        
        // ì• ì™„ë™ë¬¼ ë°°ì—´
        const pets = [];
        
        // ìŠ¤í…Œì´ì§€ ì •ë³´
        const stageInfo = {
            1: { monsters: 1, bosses: 1, name: "ìŠ¤í…Œì´ì§€ 1" },
            2: { monsters: 1, bosses: 1, name: "ìŠ¤í…Œì´ì§€ 2" },
            3: { monsters: 1, bosses: 1, name: "ìµœì¢… ìŠ¤í…Œì´ì§€" }
        };
        
        // ìŠ¤í…Œì´ì§€ ì§„í–‰ ìƒí™©
        let stageProgress = {
            monstersKilled: 0,
            bossesKilled: 0
        };
        
        // í­ê²©ê¸° ë°°ì—´
        const bombers = [];
        
        // í‚¤ë³´ë“œ ì…ë ¥
        const keys = {};
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // ê°€ê´€ì´ ë°œì‚¬ (1ë²ˆí‚¤ë‚˜ 2ë²ˆí‚¤ ëª¨ë‘ 3ë°œì”©)
            if ((e.key === '1' || e.key === '2') && gameState.ammo >= 3 && !gameState.isReloading) {
                fireBullet(3);
            }
            
            // ì¥ì „ (Rí‚¤ë§Œ)
            if ((e.key === 'r' || e.key === 'R') && !gameState.isReloading) {
                reloadAmmo();
            }
            
            // í­ê²©ê¸° í˜¸ì¶œ (Aí‚¤)
            if ((e.key === 'a' || e.key === 'A') && gameState.bomberAvailable) {
                callBomber();
            }
            
            // ì—´ì‡  ì‚¬ìš© (Kí‚¤)
            if ((e.key === 'k' || e.key === 'K') && gameState.hasKey && !gameState.petRescued) {
                useKey();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // ì´ì•Œ ë°œì‚¬ í•¨ìˆ˜ (ê°€ê´€ì´ - í•­ìƒ 3ë°œì”©)
        function fireBullet(count) {
            if (gameState.ammo >= 3 && !gameState.isReloading) {
                // ê°€ê´€ì´ì€ í•­ìƒ 3ë°œì”© ë°œì‚¬
                for (let i = 0; i < 3; i++) {
                    bullets.push({
                        x: player.x + player.width,
                        y: player.y + player.height / 2 + (i - 1) * 3,
                        width: 8,
                        height: 4,
                        speed: 8,
                        color: '#FFFF00'
                    });
                }
                gameState.ammo -= 3;
            }
        }
        
        // ì¥ì „ í•¨ìˆ˜
        function reloadAmmo() {
            if (!gameState.isReloading) {
                gameState.isReloading = true;
                console.log("ğŸ”« ì¥ì „ ì¤‘...");
                
                // 0.5ì´ˆ í›„ ì¥ì „ ì™„ë£Œ
                setTimeout(() => {
                    gameState.ammo = gameState.maxAmmo;
                    gameState.isReloading = false;
                    console.log("âœ… ì¥ì „ ì™„ë£Œ!");
                }, 500);
            }
        }
        
        // í­ê²©ê¸° í˜¸ì¶œ í•¨ìˆ˜
        function callBomber() {
            if (gameState.bomberAvailable) {
                gameState.bomberAvailable = false;
                console.log("ğŸš í­ê²©ê¸° í˜¸ì¶œ!");
                
                // í­ê²©ê¸° ìƒì„±
                bombers.push({
                    x: -100,
                    y: 50,
                    width: 60,
                    height: 30,
                    speed: 3,
                    bombs: [],
                    color: '#4A4A4A'
                });
                
                // 0.5ì´ˆ í›„ í­ê²©ê¸° ì¬ì‚¬ìš© ê°€ëŠ¥
                setTimeout(() => {
                    gameState.bomberAvailable = true;
                    console.log("âœ… í­ê²©ê¸° ì¬ì‚¬ìš© ê°€ëŠ¥!");
                }, 500);
            }
        }
        
        // ì—´ì‡  ì‚¬ìš© í•¨ìˆ˜
        function useKey() {
            // ì² ì°½ ê·¼ì²˜ì—ì„œë§Œ ì—´ì‡  ì‚¬ìš© ê°€ëŠ¥
            if (player.x > 700 && player.x < 800) {
                console.log("ğŸ”‘ ì—´ì‡ ë¡œ ì² ì°½ì„ ì—´ê³  ê³ ì–‘ì´ë¥¼ êµ¬ì¶œí•©ë‹ˆë‹¤!");
                gameState.rescueAnimation = true;
                gameState.rescueStartTime = Date.now();
                gameState.hasKey = false; // ì—´ì‡  ì‚¬ìš© ì™„ë£Œ
            } else {
                console.log("âŒ ì² ì°½ ê·¼ì²˜ë¡œ ê°€ì„œ ì—´ì‡ ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”!");
            }
        }
        
        // ìë™ ì² ì¥ ì—´ê¸° í•¨ìˆ˜ (ì—´ì‡  íšë“ í›„ ì² ì¥ ê·¼ì²˜ì—ì„œ ìë™ìœ¼ë¡œ ì—´ê¸°)
        function checkAutoOpenCage() {
            if (gameState.hasKey && !gameState.petRescued && !gameState.rescueAnimation) {
                if (player.x > 700 && player.x < 800) {
                    console.log("ğŸ”‘ ìë™ìœ¼ë¡œ ì² ì°½ì„ ì—´ê³  ê³ ì–‘ì´ë¥¼ êµ¬ì¶œí•©ë‹ˆë‹¤!");
                    gameState.rescueAnimation = true;
                    gameState.rescueStartTime = Date.now();
                    gameState.hasKey = false;
                }
            }
        }
        
        // í”Œë ˆì´ì–´ ì—…ë°ì´íŠ¸
        function updatePlayer() {
            // ì¢Œìš° ì´ë™
            if (keys['ArrowLeft'] && player.x > 0) {
                player.x -= 5;
            }
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) {
                player.x += 5;
            }
            
            // ì í”„
            if (keys[' '] && !player.isJumping) {
                player.velocityY = -15;
                player.isJumping = true;
            }
            
            // ì¤‘ë ¥
            player.velocityY += 0.8;
            player.y += player.velocityY;
            
            // ë°”ë‹¥ ì²´í¬
            if (player.y > player.groundY) {
                player.y = player.groundY;
                player.velocityY = 0;
                player.isJumping = false;
            }
        }
        
        // ì´ì•Œ ì—…ë°ì´íŠ¸
        function updateBullets() {
            bullets.forEach((bullet, index) => {
                bullet.x += bullet.speed;
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (bullet.x > canvas.width) {
                    bullets.splice(index, 1);
                }
            });
        }
        
        // í­ê²©ê¸° ì—…ë°ì´íŠ¸
        function updateBombers() {
            bombers.forEach((bomber, bIndex) => {
                bomber.x += bomber.speed;
                
                // í­ê²©ê¸°ê°€ í™”ë©´ ì¤‘ì•™ì— ë„ë‹¬í•˜ë©´ í­íƒ„ íˆ¬í•˜
                if (bomber.x > canvas.width / 2 && bomber.bombs.length === 0) {
                    // ì—¬ëŸ¬ ê°œì˜ í­íƒ„ íˆ¬í•˜
                    for (let i = 0; i < 5; i++) {
                        bomber.bombs.push({
                            x: bomber.x + Math.random() * 200 - 100,
                            y: bomber.y + bomber.height,
                            width: 8,
                            height: 8,
                            speed: 2,
                            color: '#FF4500'
                        });
                    }
                }
                
                // í­íƒ„ ì—…ë°ì´íŠ¸
                bomber.bombs.forEach((bomb, bombIndex) => {
                    bomb.y += bomb.speed;
                    
                    // í­íƒ„ì´ ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ í­ë°œ
                    if (bomb.y > 300) {
                        bomber.bombs.splice(bombIndex, 1);
                        
                        // í­ë°œ ë²”ìœ„ ë‚´ì˜ ì ë“¤ ì œê±°
                        enemies.forEach((enemy, eIndex) => {
                            const distance = Math.abs(enemy.x - bomb.x);
                            if (distance < 100) {
                                enemies.splice(eIndex, 1);
                                gameState.score += 30;
                                console.log(`ğŸ’¥ í­ê²©ìœ¼ë¡œ ì  ì²˜ì¹˜! ì ìˆ˜: ${gameState.score}`);
                            }
                        });
                    }
                });
                
                // í­ê²©ê¸°ê°€ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (bomber.x > canvas.width + 100) {
                    bombers.splice(bIndex, 1);
                }
            });
        }
        
        // ì  ìƒì„±
        function createEnemy() {
            const enemyTypes = [
                { type: 'monster', width: 30, height: 40, color: '#FF0000', speed: -2, hp: 100, damage: 15 },
                { type: 'tank', width: 50, height: 30, color: '#8B4513', speed: -1, hp: 50, damage: 25 }
            ];
            
            const enemyType = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            
            enemies.push({
                x: canvas.width,
                y: 300,
                width: enemyType.width,
                height: enemyType.height,
                color: enemyType.color,
                speed: enemyType.speed,
                hp: enemyType.hp,
                maxHp: enemyType.hp,
                type: enemyType.type,
                damage: enemyType.damage,
                lastAttackTime: 0,  // ë§ˆì§€ë§‰ ê³µê²© ì‹œê°„
                lastShootTime: 0    // ë§ˆì§€ë§‰ ì´ì•Œ ë°œì‚¬ ì‹œê°„
            });
        }
        
        // ë³´ìŠ¤ ìƒì„±
        function createBoss() {
            const bossTypes = [
                { type: 'giant', width: 80, height: 60, color: '#8B0000', speed: -1, hp: 200, damage: 30 },
                { type: 'robot', width: 70, height: 50, color: '#2F4F4F', speed: -1.5, hp: 150, damage: 25 }
            ];
            
            const bossType = bossTypes[Math.floor(Math.random() * bossTypes.length)];
            
            bosses.push({
                x: canvas.width,
                y: 280,
                width: bossType.width,
                height: bossType.height,
                color: bossType.color,
                speed: bossType.speed,
                hp: bossType.hp,
                maxHp: bossType.hp,
                type: bossType.type,
                damage: bossType.damage,
                lastAttackTime: 0,
                lastShootTime: 0
            });
        }
        
        // ì  ì—…ë°ì´íŠ¸
        function updateEnemies() {
            const currentTime = Date.now();
            
            enemies.forEach((enemy, index) => {
                enemy.x += enemy.speed;
                
                // ì  ì´ì•Œ ë°œì‚¬ (2ì´ˆë§ˆë‹¤)
                if (currentTime - enemy.lastShootTime > 2000) {
                    enemyBullets.push({
                        x: enemy.x,
                        y: enemy.y + enemy.height / 2,
                        width: 6,
                        height: 3,
                        speed: -6,
                        color: '#FF0000'
                    });
                    enemy.lastShootTime = currentTime;
                }
                
                // í”Œë ˆì´ì–´ì™€ ì  ì¶©ëŒ ì²´í¬ (ëª¬ìŠ¤í„° ê³µê²©)
                if (enemy.x < player.x + player.width &&
                    enemy.x + enemy.width > player.x &&
                    enemy.y < player.y + player.height &&
                    enemy.y + enemy.height > player.y) {
                    
                    // 1ì´ˆë§ˆë‹¤ í•œ ë²ˆì”©ë§Œ ê³µê²©
                    if (currentTime - enemy.lastAttackTime > 1000) {
                        gameState.playerHP -= enemy.damage;
                        enemy.lastAttackTime = currentTime;
                        console.log(`ğŸ’¥ ${enemy.type}ì—ê²Œ ê³µê²©ë°›ìŒ! HP: ${gameState.playerHP}`);
                    }
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (enemy.x + enemy.width < 0) {
                    enemies.splice(index, 1);
                    gameState.playerHP -= 5; // ì ì´ ì§€ë‚˜ê°€ë©´ ì‘ì€ ë°ë¯¸ì§€
                }
            });
        }
        
        // ë³´ìŠ¤ ì—…ë°ì´íŠ¸
        function updateBosses() {
            const currentTime = Date.now();
            
            bosses.forEach((boss, index) => {
                boss.x += boss.speed;
                
                // ë³´ìŠ¤ ì´ì•Œ ë°œì‚¬ (30ì´ˆë§ˆë‹¤)
                if (currentTime - boss.lastShootTime > 30000) {
                    // ë³´ìŠ¤ëŠ” 3ë°œì”© ë°œì‚¬
                    for (let i = 0; i < 3; i++) {
                        enemyBullets.push({
                            x: boss.x,
                            y: boss.y + boss.height / 2 + (i - 1) * 10,
                            width: 8,
                            height: 4,
                            speed: -8,
                            color: '#FF4500'
                        });
                    }
                    boss.lastShootTime = currentTime;
                }
                
                // í”Œë ˆì´ì–´ì™€ ë³´ìŠ¤ ì¶©ëŒ ì²´í¬
                if (boss.x < player.x + player.width &&
                    boss.x + boss.width > player.x &&
                    boss.y < player.y + player.height &&
                    boss.y + boss.height > player.y) {
                    
                    // 1ì´ˆë§ˆë‹¤ í•œ ë²ˆì”©ë§Œ ê³µê²©
                    if (currentTime - boss.lastAttackTime > 1000) {
                        gameState.playerHP -= boss.damage;
                        boss.lastAttackTime = currentTime;
                        console.log(`ğŸ’¥ ${boss.type} ë³´ìŠ¤ì—ê²Œ ê³µê²©ë°›ìŒ! HP: ${gameState.playerHP}`);
                    }
                }
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (boss.x + boss.width < 0) {
                    bosses.splice(index, 1);
                    gameState.playerHP -= 20; // ë³´ìŠ¤ê°€ ì§€ë‚˜ê°€ë©´ í° ë°ë¯¸ì§€
                }
            });
        }
        
        // ì  ì´ì•Œ ì—…ë°ì´íŠ¸
        function updateEnemyBullets() {
            enemyBullets.forEach((bullet, index) => {
                bullet.x += bullet.speed;
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (bullet.x < 0) {
                    enemyBullets.splice(index, 1);
                }
            });
        }
        
        // ì¶©ëŒ ì²´í¬
        function checkCollisions() {
            // í”Œë ˆì´ì–´ ì´ì•Œê³¼ ì  ì¶©ëŒ
            bullets.forEach((bullet, bIndex) => {
                enemies.forEach((enemy, eIndex) => {
                    if (bullet.x < enemy.x + enemy.width &&
                        bullet.x + bullet.width > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + bullet.height > enemy.y) {
                        
                        // ì´ì•Œ ì œê±°
                        bullets.splice(bIndex, 1);
                        
                        // ì  ì²´ë ¥ ê°ì†Œ
                        enemy.hp -= 10;
                        gameState.score += 5;
                        
                        // ì  ì œê±°
                        if (enemy.hp <= 0) {
                            enemies.splice(eIndex, 1);
                            gameState.score += 20;
                            stageProgress.monstersKilled++;
                            
                            // HP íšŒë³µ (ì  íƒ€ì…ì— ë”°ë¼)
                            if (enemy.type === 'tank') {
                                // ê°ˆìƒ‰ íƒ±í¬ë¥¼ ì£½ì´ë©´ HP 50 íšŒë³µ
                                gameState.playerHP = Math.min(gameState.playerHP + 50, gameState.maxHP);
                                console.log(`ğŸ’š íƒ±í¬ ì²˜ì¹˜! HP 50 íšŒë³µ! í˜„ì¬ HP: ${gameState.playerHP}`);
                            } else if (enemy.type === 'monster') {
                                // ë¹¨ê°„ìƒ‰ ëª¬ìŠ¤í„°ë¥¼ ì£½ì´ë©´ HP 100 íšŒë³µ
                                gameState.playerHP = Math.min(gameState.playerHP + 100, gameState.maxHP);
                                console.log(`ğŸ’š ëª¬ìŠ¤í„° ì²˜ì¹˜! HP 100 íšŒë³µ! í˜„ì¬ HP: ${gameState.playerHP}`);
                            }
                            
                            // ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì²´í¬
                            checkStageComplete();
                        }
                    }
                });
                
                // í”Œë ˆì´ì–´ ì´ì•Œê³¼ ë³´ìŠ¤ ì¶©ëŒ
                bosses.forEach((boss, bIndex) => {
                    if (bullet.x < boss.x + boss.width &&
                        bullet.x + bullet.width > boss.x &&
                        bullet.y < boss.y + boss.height &&
                        bullet.y + bullet.height > boss.y) {
                        
                        // ì´ì•Œ ì œê±°
                        bullets.splice(bIndex, 1);
                        
                        // ë³´ìŠ¤ ì²´ë ¥ ê°ì†Œ
                        boss.hp -= 15;
                        gameState.score += 10;
                        
                        // ë³´ìŠ¤ ì œê±°
                        if (boss.hp <= 0) {
                            bosses.splice(bIndex, 1);
                            gameState.score += 100;
                            stageProgress.bossesKilled++;
                            gameState.playerHP = Math.min(gameState.playerHP + 150, gameState.maxHP);
                            console.log(`ğŸ’š ë³´ìŠ¤ ì²˜ì¹˜! HP 150 íšŒë³µ! ì ìˆ˜: ${gameState.score}`);
                            
                            // ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì²´í¬
                            checkStageComplete();
                        }
                    }
                });
            });
            
            // ì  ì´ì•Œê³¼ í”Œë ˆì´ì–´ ì¶©ëŒ
            enemyBullets.forEach((bullet, bIndex) => {
                if (bullet.x < player.x + player.width &&
                    bullet.x + bullet.width > player.x &&
                    bullet.y < player.y + player.height &&
                    bullet.y + bullet.height > player.y) {
                    
                    // ì  ì´ì•Œ ì œê±°
                    enemyBullets.splice(bIndex, 1);
                    
                    // í”Œë ˆì´ì–´ ë°ë¯¸ì§€
                    gameState.playerHP -= 10;
                    console.log(`ğŸ’¥ ì  ì´ì•Œì— ë§ìŒ! HP: ${gameState.playerHP}`);
                }
            });
        }
        
        // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸° (ê³ ì–‘ì´)
        function drawPlayer() {
            // ê³ ì–‘ì´ ëª¸ì²´ (HPì— ë”°ë¼ ìƒ‰ìƒ ë³€í™”)
            const healthPercentage = gameState.playerHP / gameState.maxHP;
            let bodyColor = player.color;
            
            if (healthPercentage < 0.3) {
                bodyColor = '#FF0000'; // ë¹¨ê°„ìƒ‰ (ìœ„í—˜)
            } else if (healthPercentage < 0.6) {
                bodyColor = '#FFA500'; // ì£¼í™©ìƒ‰ (ì£¼ì˜)
            }
            
            ctx.fillStyle = bodyColor;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // ê³ ì–‘ì´ ì–¼êµ´
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y + 15, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ê·€
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(player.x + 5, player.y - 5, 8, 15);
            ctx.fillRect(player.x + 27, player.y - 5, 8, 15);
            
            // ê³ ì–‘ì´ ëˆˆ
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(player.x + 15, player.y + 10, 3, 0, Math.PI * 2);
            ctx.arc(player.x + 25, player.y + 10, 3, 0, Math.PI * 2);
            ctx.fill();
            
                         // ê³ ì–‘ì´ ê°€ê´€ì´ (ë” í° ì´)
             ctx.fillStyle = '#333';
             ctx.fillRect(player.x + 35, player.y + 15, 25, 6);
             // ê°€ê´€ì´ ë°°ëŸ´
             ctx.fillStyle = '#666';
             ctx.fillRect(player.x + 35, player.y + 13, 3, 10);
             ctx.fillRect(player.x + 35, player.y + 17, 3, 10);
            
            // í”Œë ˆì´ì–´ HP ë°”
            const hpBarWidth = player.width;
            const hpBarHeight = 4;
            const hpPercentage = gameState.playerHP / gameState.maxHP;
            
            ctx.fillStyle = '#FF0000';
            ctx.fillRect(player.x, player.y - 10, hpBarWidth, hpBarHeight);
            ctx.fillStyle = '#00FF00';
            ctx.fillRect(player.x, player.y - 10, hpBarWidth * hpPercentage, hpBarHeight);
        }
        
        // ì´ì•Œ ê·¸ë¦¬ê¸°
        function drawBullets() {
            bullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            });
        }
        
        // í­ê²©ê¸° ê·¸ë¦¬ê¸°
        function drawBombers() {
            bombers.forEach(bomber => {
                // í­ê²©ê¸° ëª¸ì²´
                ctx.fillStyle = bomber.color;
                ctx.fillRect(bomber.x, bomber.y, bomber.width, bomber.height);
                
                // í­ê²©ê¸° ë‚ ê°œ
                ctx.fillStyle = '#666';
                ctx.fillRect(bomber.x - 10, bomber.y + 5, 20, 8);
                ctx.fillRect(bomber.x + bomber.width - 10, bomber.y + 5, 20, 8);
                
                // í­íƒ„ ê·¸ë¦¬ê¸°
                bomber.bombs.forEach(bomb => {
                    ctx.fillStyle = bomb.color;
                    ctx.fillRect(bomb.x, bomb.y, bomb.width, bomb.height);
                });
            });
        }
        
        // ì  ê·¸ë¦¬ê¸°
        function drawEnemies() {
            enemies.forEach(enemy => {
                // ì  ëª¸ì²´
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // ì  ì´
                ctx.fillStyle = '#333';
                ctx.fillRect(enemy.x - 15, enemy.y + enemy.height / 2 - 2, 15, 4);
                
                // HP ë°”
                const hpBarWidth = enemy.width;
                const hpBarHeight = 4;
                const hpPercentage = enemy.hp / enemy.maxHp;
                
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(enemy.x, enemy.y - 10, hpBarWidth, hpBarHeight);
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(enemy.x, enemy.y - 10, hpBarWidth * hpPercentage, hpBarHeight);
            });
        }
        
        // ë³´ìŠ¤ ê·¸ë¦¬ê¸°
        function drawBosses() {
            bosses.forEach(boss => {
                // ë³´ìŠ¤ ëª¸ì²´
                ctx.fillStyle = boss.color;
                ctx.fillRect(boss.x, boss.y, boss.width, boss.height);
                
                // ë³´ìŠ¤ ì´
                ctx.fillStyle = '#333';
                ctx.fillRect(boss.x - 20, boss.y + boss.height / 2 - 3, 20, 6);
                
                // ë³´ìŠ¤ HP ë°”
                const hpBarWidth = boss.width;
                const hpBarHeight = 6;
                const hpPercentage = boss.hp / boss.maxHp;
                
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(boss.x, boss.y - 15, hpBarWidth, hpBarHeight);
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(boss.x, boss.y - 15, hpBarWidth * hpPercentage, hpBarHeight);
                
                // ë³´ìŠ¤ ë¼ë²¨
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.fillText(`BOSS ${boss.type}`, boss.x, boss.y - 20);
            });
        }
        
        // ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì²´í¬
        function checkStageComplete() {
            const currentStage = stageInfo[gameState.stage];
            if (stageProgress.monstersKilled >= currentStage.monsters && 
                stageProgress.bossesKilled >= currentStage.bosses) {
                
                if (gameState.stage < 3) {
                    // ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì§„í–‰
                    gameState.stage++;
                    stageProgress.monstersKilled = 0;
                    stageProgress.bossesKilled = 0;
                    console.log(`ğŸ‰ ìŠ¤í…Œì´ì§€ ${gameState.stage - 1} ì™„ë£Œ! ìŠ¤í…Œì´ì§€ ${gameState.stage} ì‹œì‘!`);
                } else {
                    // ê²Œì„ í´ë¦¬ì–´
                    gameState.hasKey = true;
                    console.log("ğŸ‰ ëª¨ë“  ìŠ¤í…Œì´ì§€ ì™„ë£Œ! ì—´ì‡ ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!");
                }
            }
        }
        
        // ê³ ì–‘ì´ ê·¸ë¦¬ê¸° (ì² ì°½ì— ê°‡íŒ)
        function drawCagedCat() {
            // ì² ì°½ (5cm ë” ì•„ë˜ë¡œ ì´ë™ - y: 70 â†’ 120)
            ctx.fillStyle = '#666';
            ctx.fillRect(750, 120, 40, 60);
            
            // ì² ì°½ ë§‰ëŒ€ë“¤
            for (let i = 0; i < 5; i++) {
                ctx.fillStyle = '#333';
                ctx.fillRect(752 + i * 8, 120, 2, 60);
            }
            
            // ìë¬¼ì‡  (ì—´ì‡ ë¡œ ì—´ê¸° ì „ê¹Œì§€ í‘œì‹œ)
            if (!gameState.rescueAnimation && !gameState.petRescued) {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(770, 140, 8, 12);
                
                // ìë¬¼ì‡  êµ¬ë©
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(774, 146, 2, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ê³ ì–‘ì´
            if (!gameState.rescueAnimation && !gameState.petRescued) {
                // ê°‡íŒ ê³ ì–‘ì´
                drawCagedCatBody();
            } else if (gameState.rescueAnimation) {
                // êµ¬ì¶œ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì¸ ê³ ì–‘ì´
                drawRescueAnimation();
            } else {
                // êµ¬ì¶œ ì™„ë£Œëœ ê³ ì–‘ì´ (ë§Œì„¸í•˜ëŠ” ëª¨ìŠµ)
                drawRescuedCat();
            }
        }
        
        // ê°‡íŒ ê³ ì–‘ì´ ê·¸ë¦¬ê¸°
        function drawCagedCatBody() {
            // ê³ ì–‘ì´ ëª¸ì²´ (5cm ë” ì•„ë˜ë¡œ ì´ë™ - y: 80 â†’ 130)
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(755, 130, 30, 30);
            
            // ê³ ì–‘ì´ ì–¼êµ´
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(770, 140, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ëˆˆ
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(767, 138, 2, 0, Math.PI * 2);
            ctx.arc(773, 138, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // ê³ ì–‘ì´ ì… (ìŠ¬í”ˆ í‘œì •)
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.arc(770, 145, 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // êµ¬ì¶œ ì• ë‹ˆë©”ì´ì…˜ ê·¸ë¦¬ê¸°
        function drawRescueAnimation() {
            const currentTime = Date.now();
            const elapsed = currentTime - gameState.rescueStartTime;
            
            if (elapsed < 3000) { // 3ì´ˆê°„ ì• ë‹ˆë©”ì´ì…˜
                // ì² ì°½ì—ì„œ í™”ë©´ ì¤‘ì•™ìœ¼ë¡œ ì´ë™í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜
                const progress = elapsed / 3000;
                const startX = 755;
                const endX = canvas.width / 2 - 15; // í™”ë©´ ì¤‘ì•™
                const catX = startX + (endX - startX) * progress;
                const catY = 130 + (300 - 130) * progress; // ë•…ìœ¼ë¡œ ë‚´ë ¤ì˜¤ëŠ” íš¨ê³¼ (ì‹œì‘ì ì„ 130ìœ¼ë¡œ ì¡°ì •)
                
                // ê³ ì–‘ì´ ëª¸ì²´
                ctx.fillStyle = '#FFA500';
                ctx.fillRect(catX, catY, 30, 30);
                
                // ê³ ì–‘ì´ ì–¼êµ´
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(catX + 15, catY + 10, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // ê³ ì–‘ì´ ëˆˆ (í–‰ë³µí•œ í‘œì •)
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(catX + 12, catY + 8, 2, 0, Math.PI * 2);
                ctx.arc(catX + 18, catY + 8, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // ê³ ì–‘ì´ ì… (ì›ƒëŠ” í‘œì •)
                ctx.fillStyle = '#FF0000';
                ctx.beginPath();
                ctx.arc(catX + 15, catY + 15, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // ê³ ì–‘ì´ ê·€
                ctx.fillStyle = '#FFA500';
                ctx.fillRect(catX + 5, catY - 5, 8, 15);
                ctx.fillRect(catX + 17, catY - 5, 8, 15);
                
                // êµ¬ì¶œ ë©”ì‹œì§€
                ctx.fillStyle = 'gold';
                ctx.font = '16px Arial';
                ctx.fillText('ğŸ‰ êµ¬ì¶œ ì™„ë£Œ!', catX - 10, catY - 30);
            } else {
                // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ
                gameState.rescueAnimation = false;
                gameState.petRescued = true;
            }
        }
        
        // êµ¬ì¶œëœ ê³ ì–‘ì´ ê·¸ë¦¬ê¸° (ë§Œì„¸í•˜ëŠ” ëª¨ìŠµ)
        function drawRescuedCat() {
            // í™”ë©´ ì¤‘ì•™ ìœ„ì¹˜ ê³„ì‚°
            const screenCenterX = canvas.width / 2;
            const rescuedCatX = screenCenterX - 15; // ê³ ì–‘ì´ ë„ˆë¹„ì˜ ì ˆë°˜
            const rescuedCatY = 300; // ë•…ì— ì°©ì§€ (í”Œë ˆì´ì–´ì™€ ê°™ì€ ë†’ì´)
            
            // êµ¬ì¶œëœ ê³ ì–‘ì´ ëª¸ì²´
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(rescuedCatX, rescuedCatY, 30, 30);
            
            // êµ¬ì¶œëœ ê³ ì–‘ì´ ì–¼êµ´
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(rescuedCatX + 15, rescuedCatY + 10, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // êµ¬ì¶œëœ ê³ ì–‘ì´ ëˆˆ (í–‰ë³µí•œ í‘œì •)
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(rescuedCatX + 12, rescuedCatY + 8, 2, 0, Math.PI * 2);
            ctx.arc(rescuedCatX + 18, rescuedCatY + 8, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // êµ¬ì¶œëœ ê³ ì–‘ì´ ì… (ì›ƒëŠ” í‘œì •)
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.arc(rescuedCatX + 15, rescuedCatY + 15, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // êµ¬ì¶œëœ ê³ ì–‘ì´ ê·€
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(rescuedCatX + 5, rescuedCatY - 5, 8, 15);
            ctx.fillRect(rescuedCatX + 17, rescuedCatY - 5, 8, 15);
            
            // ë§Œì„¸í•˜ëŠ” íŒ”
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(rescuedCatX + 25, rescuedCatY - 15, 4, 15); // ì˜¤ë¥¸íŒ”
            ctx.fillRect(rescuedCatX + 1, rescuedCatY - 15, 4, 15);  // ì™¼íŒ”
            
            // ë§Œì„¸ ë©”ì‹œì§€
            ctx.fillStyle = 'gold';
            ctx.font = '14px Arial';
            ctx.fillText('ğŸ‰ ë§Œì„¸!', rescuedCatX - 5, rescuedCatY - 35);
            
            // í”Œë ˆì´ì–´ë„ í™”ë©´ ì¤‘ì•™ìœ¼ë¡œ ì´ë™í•´ì„œ ë§Œì„¸í•˜ëŠ” ëª¨ìŠµ ì¶”ê°€
            drawPlayerCenterCelebration();
        }
        
        // í”Œë ˆì´ì–´ ì¶•í•˜ ëª¨ìŠµ ê·¸ë¦¬ê¸°
        function drawPlayerCelebration() {
            // í”Œë ˆì´ì–´ ë§Œì„¸í•˜ëŠ” íŒ”
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(player.x + 15, player.y - 15, 4, 15); // ì™¼íŒ”
            ctx.fillRect(player.x + 21, player.y - 15, 4, 15); // ì˜¤ë¥¸íŒ”
            
            // í”Œë ˆì´ì–´ ì¶•í•˜ ë©”ì‹œì§€
            ctx.fillStyle = 'gold';
            ctx.font = '12px Arial';
            ctx.fillText('ğŸ‰ ì„±ê³µ!', player.x - 10, player.y - 35);
        }
        
        // í”Œë ˆì´ì–´ ì¤‘ì•™ ì¶•í•˜ ëª¨ìŠµ ê·¸ë¦¬ê¸°
        function drawPlayerCenterCelebration() {
            // í”Œë ˆì´ì–´ë¥¼ í™”ë©´ ì¤‘ì•™ìœ¼ë¡œ ì´ë™
            const screenCenterX = canvas.width / 2;
            const playerCenterX = screenCenterX + 50; // ê³ ì–‘ì´ ì˜†ì— ìœ„ì¹˜
            
            // í”Œë ˆì´ì–´ ëª¸ì²´ (ì¤‘ì•™ì— ìœ„ì¹˜)
            const healthPercentage = gameState.playerHP / gameState.maxHP;
            let bodyColor = player.color;
            
            if (healthPercentage < 0.3) {
                bodyColor = '#FF0000'; // ë¹¨ê°„ìƒ‰ (ìœ„í—˜)
            } else if (healthPercentage < 0.6) {
                bodyColor = '#FFA500'; // ì£¼í™©ìƒ‰ (ì£¼ì˜)
            }
            
            ctx.fillStyle = bodyColor;
            ctx.fillRect(playerCenterX, 300, player.width, player.height);
            
            // í”Œë ˆì´ì–´ ì–¼êµ´
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(playerCenterX + 20, 315, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // í”Œë ˆì´ì–´ ê·€
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(playerCenterX + 5, 295, 8, 15);
            ctx.fillRect(playerCenterX + 27, 295, 8, 15);
            
            // í”Œë ˆì´ì–´ ëˆˆ
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(playerCenterX + 15, 310, 3, 0, Math.PI * 2);
            ctx.arc(playerCenterX + 25, 310, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // í”Œë ˆì´ì–´ ê°€ê´€ì´
            ctx.fillStyle = '#333';
            ctx.fillRect(playerCenterX + 35, 315, 25, 6);
            ctx.fillStyle = '#666';
            ctx.fillRect(playerCenterX + 35, 313, 3, 10);
            ctx.fillRect(playerCenterX + 35, 317, 3, 10);
            
            // í”Œë ˆì´ì–´ ë§Œì„¸í•˜ëŠ” íŒ”
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(playerCenterX + 15, 285, 4, 15); // ì™¼íŒ”
            ctx.fillRect(playerCenterX + 21, 285, 4, 15); // ì˜¤ë¥¸íŒ”
            
            // í”Œë ˆì´ì–´ ì¶•í•˜ ë©”ì‹œì§€
            ctx.fillStyle = 'gold';
            ctx.font = '12px Arial';
            ctx.fillText('ğŸ‰ ì„±ê³µ!', playerCenterX - 10, 265);
            
            // í•¨ê»˜ ë§Œì„¸í•˜ëŠ” ë©”ì‹œì§€
            ctx.fillStyle = 'gold';
            ctx.font = '16px Arial';
            ctx.fillText('ğŸ‰ í•¨ê»˜ ë§Œì„¸! ğŸ‰', screenCenterX - 50, 250);
        }
        
        // ì—´ì‡  ê·¸ë¦¬ê¸°
        function drawKey() {
            if (gameState.hasKey && !gameState.petRescued) {
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(player.x + 10, player.y - 20, 15, 8);
                ctx.fillRect(player.x + 20, player.y - 18, 4, 4);
            }
        }
        
        // ì  ì´ì•Œ ê·¸ë¦¬ê¸°
        function drawEnemyBullets() {
            enemyBullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            });
        }
        
        // UI ê·¸ë¦¬ê¸°
        function drawUI() {
            // ì ìˆ˜
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText(`ì ìˆ˜: ${gameState.score}`, 10, 30);
            
            // í”Œë ˆì´ì–´ HP (ìƒ‰ìƒ ë³€í™”)
            const hpColor = gameState.playerHP > gameState.maxHP * 0.6 ? 'black' : gameState.playerHP > gameState.maxHP * 0.3 ? 'orange' : 'red';
            ctx.fillStyle = hpColor;
            ctx.font = '16px Arial';
            ctx.fillText(`HP: ${gameState.playerHP}/${gameState.maxHP}`, 10, 50);
            
            // ìŠ¤í…Œì´ì§€ ì •ë³´
            ctx.fillStyle = 'black';
            ctx.font = '16px Arial';
            ctx.fillText(`ìŠ¤í…Œì´ì§€: ${gameState.stage}`, 10, 70);
            ctx.fillText(`ëª¬ìŠ¤í„°: ${stageProgress.monstersKilled}/${stageInfo[gameState.stage].monsters}`, 10, 90);
            ctx.fillText(`ë³´ìŠ¤: ${stageProgress.bossesKilled}/${stageInfo[gameState.stage].bosses}`, 10, 110);
            
            // ì´ì•Œ ê°œìˆ˜
            ctx.fillStyle = gameState.ammo > 0 ? 'black' : 'red';
            ctx.font = '16px Arial';
            ctx.fillText(`ì´ì•Œ: ${gameState.ammo}/${gameState.maxAmmo}`, 10, 130);
            
            // ì¥ì „ ì¤‘ í‘œì‹œ
            if (gameState.isReloading) {
                ctx.fillStyle = 'orange';
                ctx.font = '14px Arial';
                ctx.fillText('ğŸ”« ì¥ì „ ì¤‘...', 10, 150);
            }
            
            // ê²½ê³  ë©”ì‹œì§€
            if (gameState.playerHP < gameState.maxHP * 0.3) {
                ctx.fillStyle = 'red';
                ctx.font = '18px Arial';
                ctx.fillText('âš ï¸ ìœ„í—˜! HPê°€ ë‚®ìŠµë‹ˆë‹¤!', 10, 170);
            }
            
            // HP íšŒë³µ ì•ˆë‚´
            ctx.fillStyle = 'green';
            ctx.font = '12px Arial';
            ctx.fillText('ğŸ’š íƒ±í¬ ì²˜ì¹˜: HP +50 | ëª¬ìŠ¤í„° ì²˜ì¹˜: HP +100', 10, 190);
            
            // í­ê²©ê¸° ìƒíƒœ
            if (gameState.bomberAvailable) {
                ctx.fillStyle = 'blue';
                ctx.font = '12px Arial';
                ctx.fillText('ğŸš Aí‚¤: í­ê²©ê¸° í˜¸ì¶œ ê°€ëŠ¥', 10, 210);
            } else {
                ctx.fillStyle = 'gray';
                ctx.font = '12px Arial';
                ctx.fillText('ğŸš í­ê²©ê¸° ì¬ì¶©ì „ ì¤‘...', 10, 210);
            }
            
            // ë³´ìŠ¤ ì •ë³´
            if (bosses.length > 0) {
                ctx.fillStyle = 'red';
                ctx.font = '14px Arial';
                ctx.fillText('âš ï¸ ë³´ìŠ¤ ì¶œí˜„! ì£¼ì˜í•˜ì„¸ìš”!', 10, 230);
            }
            
            // ì—´ì‡  ë³´ìœ  ì •ë³´
            if (gameState.hasKey) {
                ctx.fillStyle = 'gold';
                ctx.font = '14px Arial';
                ctx.fillText('ğŸ”‘ ì—´ì‡  íšë“! ì² ì°½ ê·¼ì²˜ì—ì„œ ìë™ìœ¼ë¡œ ê³ ì–‘ì´ë¥¼ êµ¬ì¶œí•©ë‹ˆë‹¤!', 10, 250);
            }
        }
        
        // ê²Œì„ì˜¤ë²„ í™”ë©´
        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'red';
            ctx.font = '48px Arial';
            ctx.fillText('ê²Œì„ ì˜¤ë²„!', 250, 180);
            
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.fillText(`ìµœì¢… ì ìˆ˜: ${gameState.score}`, 300, 220);
        }
        
        // ê²Œì„ í´ë¦¬ì–´ í™”ë©´
        function drawGameClear() {
            if (gameState.petRescued) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = 'gold';
                ctx.font = '48px Arial';
                ctx.fillText('ê²Œì„ í´ë¦¬ì–´!', 250, 180);
                
                ctx.fillStyle = 'white';
                ctx.font = '24px Arial';
                ctx.fillText(`ìµœì¢… ì ìˆ˜: ${gameState.score}`, 300, 220);
                ctx.fillText('ê³ ì–‘ì´ë¥¼ êµ¬ì¶œí–ˆìŠµë‹ˆë‹¤!', 280, 250);
                ctx.fillText('ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰', 300, 280);
            }
        }
        
        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            // í™”ë©´ í´ë¦¬ì–´
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (!gameState.gameOver && !gameState.petRescued) {
                // í”Œë ˆì´ì–´ ì—…ë°ì´íŠ¸
                updatePlayer();
                
                // ì´ì•Œ ì—…ë°ì´íŠ¸
                updateBullets();
                
                // í­ê²©ê¸° ì—…ë°ì´íŠ¸
                updateBombers();
                
                // ì  ì—…ë°ì´íŠ¸
                updateEnemies();
                
                // ë³´ìŠ¤ ì—…ë°ì´íŠ¸
                updateBosses();
                
                // ì  ì´ì•Œ ì—…ë°ì´íŠ¸
                updateEnemyBullets();
                
                // ì¶©ëŒ ì²´í¬
                checkCollisions();
                
                // ìë™ ì² ì¥ ì—´ê¸° ì²´í¬
                checkAutoOpenCage();
                
                // ìŠ¤í…Œì´ì§€ 3ì—ì„œ ì—´ì‡ ë¥¼ ì–»ì€ í›„ì—ëŠ” ì  ìƒì„± ì¤‘ë‹¨
                if (!(gameState.stage === 3 && gameState.hasKey)) {
                    // ì  ìƒì„± (2ì´ˆë§ˆë‹¤)
                    if (Math.random() < 0.02) {
                        createEnemy();
                    }
                    
                    // ë³´ìŠ¤ ìƒì„± (30ì´ˆë§ˆë‹¤)
                    if (Math.random() < 0.005) {
                        createBoss();
                    }
                }
                
                // ìë™ ì¬ì¥ì „ (ì´ì•Œì´ 0ì´ ë˜ë©´ 0.1ì´ˆ í›„ ìë™ ì¬ì¥ì „)
                if (gameState.ammo <= 0 && !gameState.isReloading) {
                    setTimeout(() => {
                        gameState.ammo = gameState.maxAmmo;
                        console.log("ğŸ”« ìë™ ì¬ì¥ì „ ì™„ë£Œ!");
                    }, 100);
                }
                
                // ê²Œì„ì˜¤ë²„ ì²´í¬
                if (gameState.playerHP <= 0) {
                    gameState.gameOver = true;
                }
                
                // ê·¸ë¦¬ê¸°
                drawPlayer();
                drawBullets();
                drawBombers();
                drawEnemies();
                drawBosses();
                drawEnemyBullets();
                drawCagedCat();
                drawKey();
                drawUI();
                
                // ê²Œì„ í´ë¦¬ì–´ ì²´í¬
                drawGameClear();
            } else if (gameState.gameOver) {
                drawGameOver();
            } else if (gameState.petRescued) {
                drawGameClear();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // ê²Œì„ ì‹œì‘
        console.log("ğŸ± ê´´ë¬¼ì„ ë¬¼ë¦¬ì¹˜ê³ , ë„ˆì˜ ì• ì™„ë™ë¬¼ì„ êµ¬í•˜ë¼! ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!");
        gameLoop();
    </script>
</body>
</html> 