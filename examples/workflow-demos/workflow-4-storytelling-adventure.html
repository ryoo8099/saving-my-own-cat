<!DOCTYPE html>
<html>
<head>
    <title>바나나 히어로의 전설 - 스토리텔링 모험</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Celtic+Hand&display=swap');
        
        body { 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background: radial-gradient(circle at center, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            font-family: 'Cinzel', serif;
            color: #f39c12;
            overflow: hidden;
        }
        
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
        }
        
        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        #gameContainer {
            text-align: center;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.1);
            border: 3px solid #f39c12;
            position: relative;
        }
        
        #gameTitle {
            font-family: 'Celtic Hand', cursive;
            font-size: 28px;
            margin: 0;
            color: #f1c40f;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin-bottom: 15px;
        }
        
        canvas { 
            border: 4px solid #8e44ad; 
            background: linear-gradient(180deg, #87ceeb 0%, #98fb98 60%, #8fbc8f 100%);
            border-radius: 15px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }
        
        #storyPanel {
            margin: 15px 0;
            font-size: 16px;
            color: #ecf0f1;
            background: rgba(52, 73, 94, 0.8);
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #9b59b6;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #questInfo {
            margin: 10px 0;
            font-size: 14px;
            color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #f39c12;
        }
        
        .legend-stats {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            font-size: 14px;
            color: #e74c3c;
            font-weight: bold;
        }
        
        .achievement-notification {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #f1c40f, #f39c12);
            color: #2c3e50;
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(300px);
            transition: transform 0.5s ease;
        }
        
        .achievement-notification.show {
            transform: translateX(0);
        }
        
        .magic-button {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .magic-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div id="gameContainer">
        <h1 id="gameTitle">⚔️ 바나나 히어로의 전설 ⚔️</h1>
        
        <div id="storyPanel">
            옛날 옛날, 디지털 왕국에 전설의 바나나 히어로가 살고 있었습니다...
        </div>
        
        <div class="legend-stats">
            <span>🏆 전설 점수: <span id="legendScore">0</span></span>
            <span>💎 획득 마법석: <span id="magicStones">0</span></span>
            <span>⚔️ 처치한 악마: <span id="defeatedDemons">0</span></span>
        </div>
        
        <canvas id="mysticalCanvas" width="800" height="400"></canvas>
        
        <div id="questInfo">
            🗡️ <strong>현재 퀘스트:</strong> <span id="currentQuest">세계 창조의 마법을 배우는 중...</span><br>
            🎯 <strong>조작법:</strong> ← → 이동 | 스페이스 점프 | Z 마법 발사 | R 모험 재시작
        </div>
        
        <div>
            <button class="magic-button" onclick="teleportHero()">🌟 순간이동</button>
            <button class="magic-button" onclick="castProtection()">🛡️ 보호 마법</button>
            <button class="magic-button" onclick="unleashPower()">⚡ 힘의 각성</button>
        </div>
    </div>

    <script>
        // ✨ 전설의 시작: 디지털 왕국의 창조
        console.log("🌟 바나나 히어로의 전설이 시작됩니다!");
        console.log("📖 챕터 1: 세계 창조의 마법");
        
        const 신비한캔버스 = document.getElementById('mysticalCanvas');
        const 마법의붓 = 신비한캔버스.getContext('2d');
        const 이야기패널 = document.getElementById('storyPanel');
        const 퀘스트정보 = document.getElementById('currentQuest');
        
        // 🌌 게임 세계의 신비한 상태
        let 전설상태 = {
            점수: 0,
            마법석: 0,
            처치한악마: 0,
            현재챕터: 1,
            시작시간: Date.now(),
            게임종료: false,
            무적상태: false,
            특별능력: {
                순간이동: false,
                보호마법: false,
                힘의각성: false
            }
        };

        // 🦸‍♂️ 전설의 바나나 히어로
        const 바나나히어로 = {
            이름: "용감한 바나나 기사",
            x위치: 100,
            y위치: 300,
            너비: 50,
            높이: 50,
            점프력: 0,
            수평속도: 0,
            땅에있니: true,
            색상: '#d35400',
            생명력: 3,
            최대생명력: 3,
            경험치: 0,
            레벨: 1,
            전설능력: {
                바나나마법: true,
                이단점프: false,
                마법방어: false,
                시간조작: false
            }
        };

        // 🍌 전설의 바나나 마법석들
        let 마법바나나들 = [];
        
        // 👹 어둠의 악마 군단
        let 악마군단 = [];
        
        // ✨ 마법 효과 입자들
        let 마법입자들 = [];
        
        // 🎭 현재 이야기 장면들
        const 이야기장면들 = [
            {
                챕터: 1,
                제목: "세계의 탄생",
                내용: "디지털 왕국에 새로운 세계가 창조되었습니다. 전설의 바나나 히어로가 깨어납니다...",
                퀘스트: "영웅의 존재를 세계에 알리십시오"
            },
            {
                챕터: 2,
                제목: "움직임의 각성",
                내용: "고대의 이동 마법을 터득했습니다! 이제 영웅이 자유롭게 세계를 탐험할 수 있습니다.",
                퀘스트: "화살표 키로 세계를 탐험하십시오"
            },
            {
                챕터: 3,
                제목: "하늘을 나는 법",
                내용: "천공의 마법을 배웠습니다! 중력을 거스르는 점프의 힘을 얻었습니다.",
                퀘스트: "스페이스 키로 하늘로 뛰어오르십시오"
            },
            {
                챕터: 4,
                제목: "바나나 마법의 전수",
                내용: "전설의 바나나 마법을 습득했습니다! 황금빛 마법 바나나로 악마들을 물리치세요.",
                퀘스트: "Z키로 바나나 마법을 발사하십시오"
            },
            {
                챕터: 5,
                제목: "어둠의 침입",
                내용: "평화로운 왕국에 어둠의 악마들이 침입했습니다! 영웅의 진정한 모험이 시작됩니다.",
                퀘스트: "악마들을 물리치고 왕국을 구하십시오"
            },
            {
                챕터: 6,
                제목: "전설의 완성",
                내용: "축하합니다! 당신은 진정한 전설의 영웅이 되었습니다!",
                퀘스트: "영원히 기억될 전설을 만드십시오"
            }
        ];

        // ⌨️ 마법의 키 정령과의 계약
        const 마법의키들 = {};
        
        document.addEventListener('keydown', (마법주문) => {
            마법의키들[마법주문.key] = true;
            
            // 바나나 마법 발동!
            if ((마법주문.key === 'z' || 마법주문.key === 'Z') && !전설상태.게임종료) {
                바나나마법발사();
            }
            
            // 모험 재시작의 주문
            if ((마법주문.key === 'r' || 마법주문.key === 'R') && 전설상태.게임종료) {
                새로운모험시작();
            }
        });

        document.addEventListener('keyup', (마법주문) => {
            마법의키들[마법주문.key] = false;
        });

        // 🌟 별들 생성 (배경 효과)
        function 별들을뿌려라() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // 🍌 전설의 바나나 마법 발사
        function 바나나마법발사() {
            const 새로운마법바나나 = {
                x: 바나나히어로.x위치 + 바나나히어로.너비,
                y: 바나나히어로.y위치 + 바나나히어로.높이 / 2,
                너비: 20,
                높이: 12,
                속도: 15,
                마법력: 1,
                색상: '#f1c40f',
                궤적: [],
                생성시간: Date.now()
            };
            
            마법바나나들.push(새로운마법바나나);
            
            // 마법 발사 효과
            마법입자생성(바나나히어로.x위치 + 바나나히어로.너비, 바나나히어로.y위치 + 바나나히어로.높이/2, '#f1c40f', 8);
            
            console.log("✨ 바나나 마법 발사! 황금빛 마법이 어둠을 가른다!");
            
            // 첫 마법 사용 시 이야기 진행
            if (전설상태.현재챕터 === 4 && 마법바나나들.length === 1) {
                이야기진행(5);
            }
        }

        // 👹 악마 소환 의식
        function 악마소환() {
            const 악마종류들 = [
                { 이름: "화염악마", 색상: '#e74c3c', 속도: 2, 점수: 15, 크기: 35 },
                { 이름: "얼음악마", 색상: '#3498db', 속도: 1.5, 점수: 20, 크기: 40 },
                { 이름: "번개악마", 색상: '#9b59b6', 속도: 3, 점수: 25, 크기: 30 }
            ];
            
            const 선택된악마 = 악마종류들[Math.floor(Math.random() * 악마종류들.length)];
            
            const 새악마 = {
                이름: 선택된악마.이름,
                x: 신비한캔버스.width,
                y: 300,
                너비: 선택된악마.크기,
                높이: 선택된악마.크기 + 10,
                속도: -선택된악마.속도 * (1 + 전설상태.현재챕터 * 0.2),
                색상: 선택된악마.색상,
                점수값: 선택된악마.점수,
                생명력: 1,
                미끄러지는중: false,
                생성시간: Date.now()
            };
            
            악마군단.push(새악마);
            console.log(`⚠️ ${선택된악마.이름}이 어둠에서 나타났다!`);
        }

        // ✨ 마법 입자 효과 생성
        function 마법입자생성(x, y, 색상, 개수) {
            for (let i = 0; i < 개수; i++) {
                마법입자들.push({
                    x: x,
                    y: y,
                    속도x: (Math.random() - 0.5) * 10,
                    속도y: (Math.random() - 0.5) * 10,
                    색상: 색상,
                    생명: 40 + Math.random() * 20,
                    최대생명: 60,
                    크기: 2 + Math.random() * 4
                });
            }
        }

        // 🏆 업적 달성 알림
        function 업적달성알림(제목, 설명) {
            const notification = document.createElement('div');
            notification.className = 'achievement-notification';
            notification.innerHTML = `🏆 ${제목}<br><small>${설명}</small>`;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
            
            console.log(`🏆 업적 달성: ${제목} - ${설명}`);
        }

        // 📖 이야기 진행
        function 이야기진행(새챕터) {
            if (새챕터 <= 이야기장면들.length && 새챕터 > 전설상태.현재챕터) {
                전설상태.현재챕터 = 새챕터;
                const 현재장면 = 이야기장면들[새챕터 - 1];
                
                이야기패널.textContent = 현재장면.내용;
                퀘스트정보.textContent = 현재장면.퀘스트;
                
                // 챕터 진행 시 특별 효과
                마법입자생성(400, 200, '#f39c12', 20);
                
                console.log(`📖 ${현재장면.제목} - ${현재장면.내용}`);
                
                // 업적 체크
                switch(새챕터) {
                    case 2:
                        업적달성알림("첫 걸음", "영웅이 첫 움직임을 시작했습니다!");
                        break;
                    case 4:
                        업적달성알림("마법사", "바나나 마법을 습득했습니다!");
                        break;
                    case 5:
                        업적달성알림("전사", "첫 악마와 조우했습니다!");
                        break;
                }
            }
        }

        // 🎯 게임 세계 업데이트
        function 세계업데이트() {
            if (전설상태.게임종료) return;

            // 영웅의 이동 마법
            바나나히어로.수평속도 *= 0.8; // 부드러운 멈춤
            
            if (마법의키들['ArrowLeft'] && 바나나히어로.x위치 > 0) {
                바나나히어로.수평속도 = Math.max(바나나히어로.수평속도 - 1, -6);
                
                // 첫 이동 시 이야기 진행
                if (전설상태.현재챕터 === 1) {
                    이야기진행(2);
                }
            }
            
            if (마법의키들['ArrowRight'] && 바나나히어로.x위치 < 신비한캔버스.width - 바나나히어로.너비) {
                바나나히어로.수평속도 = Math.min(바나나히어로.수평속도 + 1, 6);
                
                if (전설상태.현재챕터 === 1) {
                    이야기진행(2);
                }
            }
            
            바나나히어로.x위치 += 바나나히어로.수평속도;

            // 점프의 마법 (천공술)
            if (마법의키들[' '] && 바나나히어로.땅에있니) {
                바나나히어로.점프력 = -16;
                바나나히어로.땅에있니 = false;
                
                // 점프 효과
                마법입자생성(바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 바나나히어로.높이, '#3498db', 6);
                
                console.log("🦸‍♂️ 영웅이 천공술로 하늘로 뛰어오른다!");
                
                // 첫 점프 시 이야기 진행
                if (전설상태.현재챕터 === 2) {
                    이야기진행(3);
                }
            }

            // 중력의 법칙
            바나나히어로.점프력 += 0.8;
            바나나히어로.y위치 += 바나나히어로.점프력;

            // 대지와의 충돌
            if (바나나히어로.y위치 > 300) {
                바나나히어로.y위치 = 300;
                바나나히어로.점프력 = 0;
                바나나히어로.땅에있니 = true;
            }

            // 마법 바나나들의 여행
            마법바나나들.forEach((바나나, 순서) => {
                바나나.x += 바나나.속도;
                
                // 마법 궤적 생성
                바나나.궤적.push({ x: 바나나.x, y: 바나나.y, 시간: Date.now() });
                if (바나나.궤적.length > 8) 바나나.궤적.shift();
                
                // 세계 끝에 도달한 바나나는 별이 되어 사라진다
                if (바나나.x > 신비한캔버스.width) {
                    마법바나나들.splice(순서, 1);
                    마법입자생성(바나나.x, 바나나.y, '#f1c40f', 5);
                }
            });

            // 악마들의 침입 (챕터 4 이후)
            if (전설상태.현재챕터 >= 4) {
                if (Math.random() < 0.008 + 전설상태.현재챕터 * 0.002) {
                    악마소환();
                }
            }

            // 악마들의 행진
            악마군단.forEach((악마, 순서) => {
                if (악마.미끄러지는중) {
                    악마.x += 8; // 미끄러지며 도망
                } else {
                    악마.x += 악마.속도;
                }
                
                // 화면 밖으로 사라진 악마
                if (악마.x < -악마.너비 || 악마.x > 신비한캔버스.width + 악마.너비) {
                    악마군단.splice(순서, 1);
                }
            });

            // 마법 입자들의 춤
            마법입자들.forEach((입자, 순서) => {
                입자.x += 입자.속도x;
                입자.y += 입자.속도y;
                입자.속도x *= 0.98;
                입자.속도y *= 0.98;
                입자.생명--;
                
                if (입자.생명 <= 0) {
                    마법입자들.splice(순서, 1);
                }
            });

            // 전투의 판정
            전투판정();
            
            // 첫 마법 사용 시 이야기 진행
            if (전설상태.현재챕터 === 3 && 마법바나나들.length > 0) {
                이야기진행(4);
            }
            
            // UI 업데이트
            UI업데이트();
        }

        // ⚔️ 전투 판정 시스템
        function 전투판정() {
            // 바나나 마법과 악마의 충돌
            마법바나나들.forEach((바나나, 바나나순서) => {
                악마군단.forEach((악마, 악마순서) => {
                    if (!악마.미끄러지는중 &&
                        바나나.x < 악마.x + 악마.너비 &&
                        바나나.x + 바나나.너비 > 악마.x &&
                        바나나.y < 악마.y + 악마.높이 &&
                        바나나.y + 바나나.높이 > 악마.y) {
                        
                        // 마법 명중! 대폭발 효과
                        마법입자생성(악마.x + 악마.너비/2, 악마.y + 악마.높이/2, 악마.색상, 15);
                        마법입자생성(바나나.x, 바나나.y, '#f1c40f', 8);
                        
                        // 악마가 미끄러지며 도망
                        악마.미끄러지는중 = true;
                        악마.색상 = '#95a5a6'; // 회색으로 변함
                        
                        // 전설 점수 획득
                        전설상태.점수 += 악마.점수값;
                        전설상태.마법석 += 1;
                        전설상태.처치한악마 += 1;
                        
                        // 마법바나나 소멸
                        마법바나나들.splice(바나나순서, 1);
                        
                        console.log(`💥 ${악마.이름} 격퇴! 전설 점수 +${악마.점수값}! 총 점수: ${전설상태.점수}`);
                        
                        // 특별 업적 체크
                        if (전설상태.처치한악마 === 1) {
                            업적달성알림("첫 승리", "첫 악마를 물리쳤습니다!");
                        }
                        if (전설상태.점수 >= 100) {
                            업적달성알림("백인장", "100점을 달성했습니다!");
                        }
                        
                        // 도망가는 악마는 1초 후 완전히 사라짐
                        setTimeout(() => {
                            const 인덱스 = 악마군단.indexOf(악마);
                            if (인덱스 > -1) {
                                악마군단.splice(인덱스, 1);
                                console.log(`${악마.이름}이 어둠 속으로 완전히 사라졌다...`);
                            }
                        }, 1000);
                    }
                });
            });

            // 영웅과 악마의 충돌
            if (!전설상태.무적상태) {
                악마군단.forEach((악마, 순서) => {
                    if (!악마.미끄러지는중 &&
                        바나나히어로.x위치 < 악마.x + 악마.너비 &&
                        바나나히어로.x위치 + 바나나히어로.너비 > 악마.x &&
                        바나나히어로.y위치 < 악마.y + 악마.높이 &&
                        바나나히어로.y위치 + 바나나히어로.높이 > 악마.y) {
                        
                        // 영웅이 피해를 입음
                        바나나히어로.생명력--;
                        전설상태.무적상태 = true;
                        
                        // 피해 효과
                        마법입자생성(바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 바나나히어로.높이/2, '#e74c3c', 12);
                        
                        // 악마 제거
                        악마군단.splice(순서, 1);
                        
                        console.log(`💔 영웅이 피해를 입었다! 남은 생명력: ${바나나히어로.생명력}`);
                        
                        // 2초 무적 시간
                        setTimeout(() => {
                            전설상태.무적상태 = false;
                        }, 2000);
                        
                        // 게임 오버 체크
                        if (바나나히어로.생명력 <= 0) {
                            전설상태.게임종료 = true;
                            console.log("💀 영웅이 쓰러졌다... 하지만 전설은 영원히 기억될 것이다!");
                        }
                    }
                });
            }
        }

        // 📊 UI 정보 업데이트
        function UI업데이트() {
            document.getElementById('legendScore').textContent = 전설상태.점수;
            document.getElementById('magicStones').textContent = 전설상태.마법석;
            document.getElementById('defeatedDemons').textContent = 전설상태.처치한악마;
        }

        // 🎨 신비한 세계 그리기
        function 세계그리기() {
            // 화면 지우기
            마법의붓.clearRect(0, 0, 신비한캔버스.width, 신비한캔버스.height);

            // 신비한 구름들
            마법의붓.fillStyle = 'rgba(255, 255, 255, 0.6)';
            for (let i = 0; i < 6; i++) {
                const x = (i * 150 + Date.now() * 0.02) % (신비한캔버스.width + 120);
                const y = 60 + Math.sin(Date.now() * 0.001 + i) * 30;
                마법의붓.beginPath();
                마법의붓.arc(x, y, 20, 0, Math.PI * 2);
                마법의붓.arc(x + 15, y, 25, 0, Math.PI * 2);
                마법의붓.arc(x + 30, y, 20, 0, Math.PI * 2);
                마법의붓.fill();
            }

            // 신성한 대지
            const 대지그라디언트 = 마법의붓.createLinearGradient(0, 340, 0, 400);
            대지그라디언트.addColorStop(0, '#27ae60');
            대지그라디언트.addColorStop(1, '#1e8449');
            마법의붓.fillStyle = 대지그라디언트;
            마법의붓.fillRect(0, 340, 신비한캔버스.width, 60);

            // 전설의 바나나 히어로 (무적 시 깜빡임)
            if (!전설상태.무적상태 || Math.floor(Date.now() / 200) % 2) {
                // 영웅의 오라
                const 영웅오라 = 마법의붓.createRadialGradient(
                    바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 바나나히어로.높이/2, 0,
                    바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 바나나히어로.높이/2, 35
                );
                영웅오라.addColorStop(0, 'rgba(241, 196, 15, 0.3)');
                영웅오라.addColorStop(1, 'rgba(241, 196, 15, 0)');
                마법의붓.fillStyle = 영웅오라;
                마법의붓.fillRect(바나나히어로.x위치 - 10, 바나나히어로.y위치 - 10, 바나나히어로.너비 + 20, 바나나히어로.높이 + 20);
                
                // 영웅 본체
                마법의붓.fillStyle = 바나나히어로.색상;
                마법의붓.fillRect(바나나히어로.x위치, 바나나히어로.y위치, 바나나히어로.너비, 바나나히어로.높이);
                
                // 영웅의 왕관
                마법의붓.fillStyle = '#f1c40f';
                마법의붓.beginPath();
                마법의붓.arc(바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 15, 18, 0, Math.PI * 2);
                마법의붓.fill();
                
                // 영웅의 눈 (지혜의 빛)
                마법의붓.fillStyle = '#2c3e50';
                마법의붓.fillRect(바나나히어로.x위치 + 15, 바나나히어로.y위치 + 10, 4, 4);
                마법의붓.fillRect(바나나히어로.x위치 + 30, 바나나히어로.y위치 + 10, 4, 4);
                
                // 영웅의 미소
                마법의붓.strokeStyle = '#2c3e50';
                마법의붓.lineWidth = 2;
                마법의붓.beginPath();
                마법의붓.arc(바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 20, 8, 0, Math.PI);
                마법의붓.stroke();
            }

            // 생명력 하트들
            for (let i = 0; i < 바나나히어로.최대생명력; i++) {
                마법의붓.fillStyle = i < 바나나히어로.생명력 ? '#e74c3c' : '#7f8c8d';
                마법의붓.font = '20px Arial';
                마법의붓.fillText('💖', 10 + i * 30, 30);
            }

            // 마법 바나나들의 궤적과 광채
            마법바나나들.forEach(바나나 => {
                // 마법 궤적
                바나나.궤적.forEach((점, 인덱스) => {
                    const 투명도 = 인덱스 / 바나나.궤적.length;
                    마법의붓.fillStyle = `rgba(241, 196, 15, ${투명도 * 0.6})`;
                    마법의붓.fillRect(점.x - 2, 점.y - 2, 4, 4);
                });
                
                // 바나나 본체 (황금 빛)
                마법의붓.fillStyle = 바나나.색상;
                마법의붓.fillRect(바나나.x, 바나나.y, 바나나.너비, 바나나.높이);
                
                // 마법 오라
                마법의붓.fillStyle = 'rgba(241, 196, 15, 0.4)';
                마법의붓.fillRect(바나나.x - 2, 바나나.y - 2, 바나나.너비 + 4, 바나나.높이 + 4);
            });

            // 어둠의 악마들
            악마군단.forEach(악마 => {
                // 악마의 어둠 오라
                const 어둠오라 = 마법의붓.createRadialGradient(
                    악마.x + 악마.너비/2, 악마.y + 악마.높이/2, 0,
                    악마.x + 악마.너비/2, 악마.y + 악마.높이/2, 30
                );
                어둠오라.addColorStop(0, `${악마.색상}40`);
                어둠오라.addColorStop(1, 'rgba(0, 0, 0, 0)');
                마법의붓.fillStyle = 어둠오라;
                마법의붓.fillRect(악마.x - 15, 악마.y - 15, 악마.너비 + 30, 악마.높이 + 30);
                
                // 악마 본체
                마법의붓.fillStyle = 악마.색상;
                마법의붓.fillRect(악마.x, 악마.y, 악마.너비, 악마.높이);
                
                // 악마의 뿔
                마법의붓.fillStyle = '#2c3e50';
                마법의붓.fillRect(악마.x + 5, 악마.y, 3, 8);
                마법의붓.fillRect(악마.x + 악마.너비 - 8, 악마.y, 3, 8);
                
                // 악마의 불타는 눈
                마법의붓.fillStyle = '#f39c12';
                마법의붓.fillRect(악마.x + 8, 악마.y + 12, 4, 4);
                마법의붓.fillRect(악마.x + 악마.너비 - 12, 악마.y + 12, 4, 4);
                
                // 미끄러지는 상태 표시
                if (악마.미끄러지는중) {
                    마법의붓.fillStyle = '#f1c40f';
                    마법의붓.font = '16px Arial';
                    마법의붓.fillText('💫', 악마.x + 5, 악마.y - 5);
                }
            });

            // 마법 입자들의 춤
            마법입자들.forEach(입자 => {
                const 투명도 = 입자.생명 / 입자.최대생명;
                마법의붓.fillStyle = 입자.색상.replace('rgb', 'rgba').replace(')', `, ${투명도})`);
                마법의붓.beginPath();
                마법의붓.arc(입자.x, 입자.y, 입자.크기 * 투명도, 0, Math.PI * 2);
                마법의붓.fill();
            });

            // 게임 종료 시 전설의 기록
            if (전설상태.게임종료) {
                마법의붓.fillStyle = 'rgba(0, 0, 0, 0.9)';
                마법의붓.fillRect(0, 0, 신비한캔버스.width, 신비한캔버스.height);
                
                마법의붓.fillStyle = '#f1c40f';
                마법의붓.font = 'bold 36px Cinzel';
                마법의붓.textAlign = 'center';
                마법의붓.fillText('⚔️ 전설 완료 ⚔️', 신비한캔버스.width/2, 신비한캔버스.height/2 - 80);
                
                마법의붓.fillStyle = '#ecf0f1';
                마법의붓.font = '20px Cinzel';
                마법의붓.fillText(`전설 점수: ${전설상태.점수}`, 신비한캔버스.width/2, 신비한캔버스.height/2 - 30);
                마법의붓.fillText(`획득 마법석: ${전설상태.마법석}`, 신비한캔버스.width/2, 신비한캔버스.height/2);
                마법의붓.fillText(`처치한 악마: ${전설상태.처치한악마}`, 신비한캔버스.width/2, 신비한캔버스.height/2 + 30);
                
                마법의붓.fillStyle = '#3498db';
                마법의붓.font = '16px Cinzel';
                마법의붓.fillText('🔄 R키를 눌러 새로운 전설을 시작하세요', 신비한캔버스.width/2, 신비한캔버스.height/2 + 80);
                
                마법의붓.textAlign = 'left';
            }
        }

        // 🌟 특별 능력들
        function teleportHero() {
            if (!전설상태.게임종료) {
                바나나히어로.x위치 = Math.random() * (신비한캔버스.width - 바나나히어로.너비);
                마법입자생성(바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 바나나히어로.높이/2, '#9b59b6', 15);
                console.log("✨ 순간이동 마법 발동!");
            }
        }

        function castProtection() {
            if (!전설상태.게임종료 && !전설상태.무적상태) {
                전설상태.무적상태 = true;
                마법입자생성(바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 바나나히어로.높이/2, '#3498db', 20);
                console.log("🛡️ 보호 마법 발동! 5초간 무적!");
                setTimeout(() => {
                    전설상태.무적상태 = false;
                    console.log("🛡️ 보호 마법이 해제되었습니다.");
                }, 5000);
            }
        }

        function unleashPower() {
            if (!전설상태.게임종료) {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        바나나마법발사();
                    }, i * 100);
                }
                마법입자생성(바나나히어로.x위치 + 바나나히어로.너비/2, 바나나히어로.y위치 + 바나나히어로.높이/2, '#e74c3c', 25);
                console.log("⚡ 힘의 각성! 연속 바나나 마법!");
            }
        }

        // 🔄 새로운 모험 시작
        function 새로운모험시작() {
            전설상태 = {
                점수: 0,
                마법석: 0,
                처치한악마: 0,
                현재챕터: 1,
                시작시간: Date.now(),
                게임종료: false,
                무적상태: false,
                특별능력: {
                    순간이동: false,
                    보호마법: false,
                    힘의각성: false
                }
            };
            
            바나나히어로.x위치 = 100;
            바나나히어로.y위치 = 300;
            바나나히어로.점프력 = 0;
            바나나히어로.수평속도 = 0;
            바나나히어로.땅에있니 = true;
            바나나히어로.생명력 = 바나나히어로.최대생명력;
            
            마법바나나들 = [];
            악마군단 = [];
            마법입자들 = [];
            
            // 첫 번째 이야기로 돌아가기
            const 첫장면 = 이야기장면들[0];
            이야기패널.textContent = 첫장면.내용;
            퀘스트정보.textContent = 첫장면.퀘스트;
            
            console.log("🔄 새로운 전설이 시작됩니다!");
        }

        // 🎮 전설의 게임 루프
        function 전설의게임루프() {
            세계업데이트();
            세계그리기();
            requestAnimationFrame(전설의게임루프);
        }

        // 🚀 전설의 시작
        console.log("🌟 바나나 히어로의 전설 - 스토리텔링 모험!");
        console.log("📖 특징:");
        console.log("  - 서사적 게임 개발");
        console.log("  - 한국어 변수명 사용");
        console.log("  - 판타지 세계관");
        console.log("  - 챕터별 이야기 진행");
        console.log("  - 특별 마법 능력");
        
        별들을뿌려라();
        전설의게임루프();
    </script>
</body>
</html>